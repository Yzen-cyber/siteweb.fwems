<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMS STFH - Système de Gestion du Personnel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ÉCRAN DE CONNEXION -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-header">
                <div class="logo"><i class="fas fa-hospital"></i></div>
                <h1>EMS STFH</h1>
                <p>Système de Gestion du Personnel</p>
            </div>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" placeholder="email@ems.fw" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword"><i class="fas fa-lock"></i> Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="Entrez votre mot de passe" required>
                </div>
                <button type="submit" class="login-btn"><i class="fas fa-sign-in-alt"></i> Connexion</button>
            </form>
            <div class="login-footer">
                <p><strong>Utilisateurs de test :</strong></p>
                <code>karl.pierce@ems.fw / KarlPierce2026!</code><br>
                <code>kahverengi.yildiz@ems.fw / Kahverengi2026!</code>
            </div>
        </div>
    </div>

    <!-- APPLICATION PRINCIPALE -->
    <div class="app-wrapper" id="appContainer" style="display: none;">
        <nav class="navbar">
            <div class="navbar-brand"><i class="fas fa-hospital"></i> <span>EMS STFH</span></div>
            <div class="navbar-menu">
                <button class="nav-btn active" onclick="switchTab('accueil')"><i class="fas fa-home"></i> <span>Accueil</span></button>
                <button class="nav-btn" onclick="switchTab('effectif')"><i class="fas fa-users"></i> <span>Effectif</span></button>
                <button class="nav-btn" onclick="switchTab('fiches-employe')"><i class="fas fa-user-clock"></i> <span>Fiches Employée</span></button>
                <button class="nav-btn" onclick="switchTab('dispatch')"><i class="fas fa-headset"></i> <span>Dispatch</span></button>
                <button class="nav-btn" onclick="switchTab('fiche-ems')"><i class="fas fa-file-alt"></i> <span>Fiche EMS</span></button>
                <button class="nav-btn" onclick="switchTab('salaires')"><i class="fas fa-money-bill-wave"></i> <span>Salaires</span></button>
                <button class="nav-btn" onclick="switchTab('hierarchie')"><i class="fas fa-sitemap"></i> <span>Hiérarchie</span></button>
                <button class="nav-btn" onclick="switchTab('medicaments')"><i class="fas fa-pills"></i> <span>Médicaments</span></button>
                <button class="nav-btn" id="logsBtn" onclick="switchTab('logs')" style="display: none;"><i class="fas fa-history"></i> <span>Logs</span></button>
            </div>
            <div class="navbar-user">
                <img id="userAvatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23FF69B4' width='100' height='100'/%3E%3C/svg%3E" alt="Avatar" class="avatar-img">
                <div class="user-info"><i class="fas fa-user-circle"></i> <div><div id="userDisplayName">Utilisateur</div><small id="userRole">Rôle</small></div></div>
                <button class="logout-btn" onclick="handleLogout()" title="Déconnexion"><i class="fas fa-power-off"></i></button>
            </div>
        </nav>

        <div class="main-container">
            <!-- ONGLET ACCUEIL -->
            <div class="tab-pane active" id="tab-accueil">
                <div class="page-header"><h1><i class="fas fa-home"></i> Tableau de Bord</h1><p>Bienvenue dans le système de gestion EMS STFH</p></div>
                <div class="dashboard-grid">
                    <div class="dashboard-card"><div class="card-icon direction-icon"><i class="fas fa-crown"></i></div><h3>Direction</h3><p class="card-count" id="directionCount">2</p><small>Administrateurs</small></div>
                    <div class="dashboard-card"><div class="card-icon supervision-icon"><i class="fas fa-user-tie"></i></div><h3>Supervision</h3><p class="card-count" id="supervisionCount">5</p><small>Responsables</small></div>
                    <div class="dashboard-card"><div class="card-icon ems-icon"><i class="fas fa-heart"></i></div><h3>Personnel EMS</h3><p class="card-count" id="emsCount">29</p><small>Opérateurs</small></div>
                    <div class="dashboard-card"><div class="card-icon"><i class="fas fa-chart-line"></i></div><h3>Salaire Mensuel</h3><p class="card-count" id="totalSalary">--</p><small>Moyenne</small></div>
                </div>
                <div class="info-section"><h2><i class="fas fa-info-circle"></i> À propos du système</h2><p>Ce système gère l'ensemble du personnel médical avec :</p><ul><li>Gestion des effectifs par rôle</li><li>Calcul automatique des salaires</li><li>Hiérarchie organisationnelle</li><li>Suivi des connexions pour l'administration</li></ul></div>
            </div>

            <!-- ONGLET FICHES EMPLOYÉE -->
            <div class="tab-pane" id="tab-fiches-employe">
                <div class="page-header"><h1><i class="fas fa-user-clock"></i> Fiches Employée</h1><p>Suivi des heures travaillées et salaires</p></div>
                <div class="fiche-employe-controls">
                    <div class="fiche-employe-filter">
                        <label><i class="fas fa-filter"></i> Filtrer par rôle :</label>
                        <select id="ficheEmployeRoleFilter" onchange="filterFichesEmploye()">
                            <option value="">Tous les rôles</option>
                            <option value="Direction">Direction</option>
                            <option value="Supervision">Supervision</option>
                            <option value="EMS">Personnel EMS</option>
                        </select>
                    </div>
                    <div class="fiche-employe-filter">
                        <label><i class="fas fa-search"></i> Rechercher :</label>
                        <input type="text" id="ficheEmployeSearch" placeholder="Nom de l'employé..." onkeyup="filterFichesEmploye()">
                    </div>
                </div>
                <div class="fiches-employe-container" id="fichesEmployeContainer"></div>
            </div>

            <!-- ONGLET EFFECTIF -->
            <div class="tab-pane" id="tab-effectif">
                <div class="page-header"><h1><i class="fas fa-users"></i> Effectif du Personnel</h1><p>Liste complète des membres du personnel par catégorie</p></div>
                <div class="filter-bar">
                    <div class="filter-group"><label><i class="fas fa-filter"></i> Filtrer par rôle :</label><select id="roleFilter" onchange="filterStaff()"><option value="">Tous les rôles</option><option value="Direction">Direction</option><option value="Supervision">Supervision</option><option value="EMS">Personnel EMS</option></select></div>
                    <div class="filter-group"><label><i class="fas fa-search"></i> Rechercher :</label><input type="text" id="searchStaff" placeholder="Nom, grade..." onkeyup="filterStaff()"></div>
                </div>
                <div id="staffContainer" class="staff-container"></div>
            </div>

            <!-- ONGLET SALAIRES -->
            <div class="tab-pane" id="tab-salaires">
                <div class="page-header"><h1><i class="fas fa-money-bill-wave"></i> Grilles Salariales</h1><p>Configuration des salaires par grade et rôle</p></div>
                <div class="salary-section"><h2><i class="fas fa-briefcase"></i> Grille Supervision (15h minimum/semaine)</h2><div id="supervisionGrid" class="salary-grid"></div></div>
                <div class="salary-section"><h2><i class="fas fa-stethoscope"></i> Grille EMS (15h minimum/semaine)</h2><div id="emsGrid" class="salary-grid"></div></div>
                <div class="salary-info"><h3><i class="fas fa-calculator"></i> Règles de Calcul</h3><ul><li><strong>Base :</strong> Taux horaire × heures travaillées</li><li><strong>Bonus 20-30h :</strong> +15 000$</li><li><strong>Bonus 30h+ :</strong> +25 000$</li><li><strong>Bonus opération :</strong> +500$ par opération</li></ul></div>
            </div>

            <!-- ONGLET HIÉRARCHIE -->
            <div class="tab-pane" id="tab-hierarchie">
                <div class="page-header"><h1><i class="fas fa-sitemap"></i> Hiérarchie Organisationnelle</h1><p>Structure et organisation du personnel</p></div>
                <div class="hierarchy-container">
                    <div class="hierarchy-section"><h2 class="section-title direction-title"><i class="fas fa-crown"></i> Direction</h2><div class="hierarchy-grid" id="directionList"></div></div>
                    <div class="hierarchy-section"><h2 class="section-title supervision-title"><i class="fas fa-user-tie"></i> Supervision</h2><div class="hierarchy-grid" id="supervisionList"></div></div>
                    <div class="hierarchy-section"><h2 class="section-title ems-title"><i class="fas fa-heart"></i> Personnel EMS</h2><div class="hierarchy-grid" id="emsList"></div></div>
                </div>
            </div>

            <!-- ONGLET DISPATCH -->
            <div class="tab-pane" id="tab-dispatch">
                <div class="page-header"><h1><i class="fas fa-headset"></i> Centre de Dispatch</h1><p>Gestion des appels et des interventions en temps réel</p></div>
                <div class="dispatch-container">
                    <div class="dispatch-panel dispatch-left">
                        <div class="dispatch-title"><i class="fas fa-phone"></i> Appels Entrants</div>
                        <div class="calls-list" id="dispatchCallsList"></div>
                    </div>
                    <div class="dispatch-panel dispatch-center">
                        <div class="dispatch-title"><i class="fas fa-ambulance"></i> Unités en Service</div>
                        <div class="units-list" id="dispatchUnitsList"></div>
                    </div>
                    <div class="dispatch-panel dispatch-right">
                        <div class="dispatch-title"><i class="fas fa-tasks"></i> Interventions Actives</div>
                        <div class="interventions-list" id="dispatchInterventionsList"></div>
                    </div>
                </div>
            </div>

            <!-- ONGLET FICHE EMS -->
            <div class="tab-pane" id="tab-fiche-ems">
                <div class="page-header"><h1><i class="fas fa-file-alt"></i> Fiches EMS</h1><p>Gestion des fiches d'intervention EMS</p></div>
                <div class="fiche-ems-controls">
                    <button class="btn-primary" onclick="createNewFicheEMS()"><i class="fas fa-plus"></i> Créer une fiche</button>
                    <div class="fiche-search-bar">
                        <input type="text" id="ficheSearch" placeholder="Rechercher par numéro, patient..." onkeyup="filterFichesEMS()">
                        <select id="ficheStatusFilter" onchange="filterFichesEMS()">
                            <option value="">Tous les statuts</option>
                            <option value="en-cours">En Cours</option>
                            <option value="complete">Complètée</option>
                            <option value="archivee">Archivée</option>
                        </select>
                    </div>
                </div>
                <div class="fiches-container" id="fichesEMSContainer"></div>
            </div>

            <!-- ONGLET MÉDICAMENTS -->
            <div class="tab-pane" id="tab-medicaments">
                <div class="page-header"><h1><i class="fas fa-pills"></i> Répertoire des Médicaments</h1><p>Catalogue complet des médicaments disponibles avec détails et classifications</p></div>
                <div class="medicaments-filter-bar">
                    <div class="filter-group">
                        <label><i class="fas fa-filter"></i> Catégorie :</label>
                        <select id="medicamentsCategoryFilter" onchange="filterMedicaments()">
                            <option value="">Toutes les catégories</option>
                            <option value="antibiotique">Antibiotiques</option>
                            <option value="anesthesique">Anesthésiques</option>
                            <option value="analgesique">Analgésiques</option>
                            <option value="cardiovasculaire">Cardiovasculaires</option>
                            <option value="antiinflammatoire">Anti-inflammatoires</option>
                            <option value="antiviral">Antiviraux</option>
                            <option value="neurologique">Neurologiques</option>
                            <option value="digestif">Digestifs</option>
                            <option value="urgence">Urgences</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-search"></i> Rechercher :</label>
                        <input type="text" id="medicamentsSearchInput" placeholder="Nom du médicament..." onkeyup="filterMedicaments()">
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-eye"></i> Affichage :</label>
                        <div class="view-toggle">
                            <button class="view-btn active" onclick="setMedicamentsView('cards')" title="Cartes"><i class="fas fa-th"></i></button>
                            <button class="view-btn" onclick="setMedicamentsView('list')" title="Liste"><i class="fas fa-list"></i></button>
                        </div>
                    </div>
                </div>
                <div id="medicamentsContainer" class="medicaments-container cards-view"></div>
            </div>

            <!-- ONGLET LOGS (Admin/Supervision uniquement) -->
            <div class="tab-pane" id="tab-logs">
                <div class="page-header"><h1><i class="fas fa-history"></i> Journaux de Connexion</h1><p>Historique des connexions et actions du système</p></div>
                <div class="logs-filter"><button onclick="clearOldLogs()" class="btn-secondary"><i class="fas fa-trash"></i> Nettoyer (>24h)</button></div>
                <div id="logsContainer" class="logs-container"></div>
            </div>
        </div>
    </div>

    <!-- MODAL PROFIL -->
    <div class="profile-modal" id="profileModal">
        <div class="modal-content profile-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-cog"></i> Mon Profil</h2>
                <button class="close-modal" onclick="closeProfileModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="profile-body">
                <div class="profile-tabs">
                    <button class="profile-tab-btn active" onclick="switchProfileTab('info')"><i class="fas fa-user"></i> Informations</button>
                    <button class="profile-tab-btn" onclick="switchProfileTab('password')"><i class="fas fa-lock"></i> Sécurité</button>
                    <button class="profile-tab-btn" onclick="switchProfileTab('avatar')"><i class="fas fa-image"></i> Photo</button>
                    <button class="profile-tab-btn" onclick="switchProfileTab('settings')"><i class="fas fa-sliders-h"></i> Paramètres</button>
                </div>

                <!-- TAB INFO -->
                <div class="profile-tab-content active" id="tab-info">
                    <div class="profile-info-section">
                        <div class="info-item"><label>Nom Complet</label><p id="profileNom">--</p></div>
                        <div class="info-item"><label>Email</label><p id="profileEmail">--</p></div>
                        <div class="info-item"><label>Rôle</label><p id="profileRole">--</p></div>
                        <div class="info-item"><label>Grade</label><p id="profileGrade">--</p></div>
                        <div class="info-item"><label>Dernière Connexion</label><p id="profileLastLogin">--</p></div>
                    </div>
                </div>

                <!-- TAB PASSWORD -->
                <div class="profile-tab-content" id="tab-password">
                    <form class="profile-form" onsubmit="changePassword(event)">
                        <div class="form-group">
                            <label><i class="fas fa-lock"></i> Mot de passe actuel</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-key"></i> Nouveau mot de passe</label>
                            <input type="password" id="newPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-check-circle"></i> Confirmer le mot de passe</label>
                            <input type="password" id="confirmPassword" required minlength="6">
                        </div>
                        <button type="submit" class="btn-primary"><i class="fas fa-save"></i> Mettre à jour</button>
                    </form>
                </div>

                <!-- TAB AVATAR -->
                <div class="profile-tab-content" id="tab-avatar">
                    <div class="avatar-section">
                        <div class="avatar-preview">
                            <img id="avatarPreview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23FF69B4' width='100' height='100'/%3E%3C/svg%3E" alt="Avatar">
                        </div>
                        <div class="avatar-colors">
                            <label><i class="fas fa-palette"></i> Couleurs prédéfinies</label>
                            <div class="color-palette">
                                <button type="button" class="color-btn" onclick="generateColorAvatar('#FF69B4')" style="background: linear-gradient(135deg, #FF69B4, #FF1493);"></button>
                                <button type="button" class="color-btn" onclick="generateColorAvatar('#4169E1')" style="background: linear-gradient(135deg, #4169E1, #1E90FF);"></button>
                                <button type="button" class="color-btn" onclick="generateColorAvatar('#20B2AA')" style="background: linear-gradient(135deg, #20B2AA, #00CED1);"></button>
                                <button type="button" class="color-btn" onclick="generateColorAvatar('#FF6347')" style="background: linear-gradient(135deg, #FF6347, #FF4500);"></button>
                                <button type="button" class="color-btn" onclick="generateColorAvatar('#FFB347')" style="background: linear-gradient(135deg, #FFB347, #FFA500);"></button>
                                <button type="button" class="color-btn" onclick="generateColorAvatar('#90EE90')" style="background: linear-gradient(135deg, #90EE90, #32CD32);"></button>
                            </div>
                        </div>
                        <div class="avatar-upload">
                            <label><i class="fas fa-upload"></i> Uploader une photo</label>
                            <input type="file" id="avatarInput" accept="image/*" onchange="previewAvatar(event)">
                            <button type="button" class="btn-primary" onclick="changeAvatar(event)" style="margin-top: 15px;"><i class="fas fa-save"></i> Enregistrer la photo</button>
                        </div>
                    </div>
                </div>

                <!-- TAB SETTINGS -->
                <div class="profile-tab-content" id="tab-settings">
                    <div class="settings-container">
                        <div class="settings-section">
                            <h3><i class="fas fa-cog"></i> Paramètres Généraux</h3>
                            <div class="setting-item">
                                <div class="setting-label">
                                    <label>Langue</label>
                                    <small>Sélectionnez la langue de l'interface</small>
                                </div>
                                <select id="languageSetting">
                                    <option value="fr" selected>Français</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div class="setting-label">
                                    <label>Thème</label>
                                    <small>Apparence de l'interface</small>
                                </div>
                                <div class="theme-options">
                                    <label><input type="radio" name="theme" value="light" checked> Clair</label>
                                    <label><input type="radio" name="theme" value="dark"> Sombre</label>
                                    <label><input type="radio" name="theme" value="auto"> Automatique</label>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3><i class="fas fa-shield-alt"></i> Sécurité</h3>
                            <div class="setting-item">
                                <div class="setting-label">
                                    <label>Authentification à deux facteurs</label>
                                    <small>Sécurité renforcée pour votre compte</small>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="twoFactorAuth">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <button class="btn-secondary" onclick="viewActiveSessions()"><i class="fas fa-laptop"></i> Sessions actives</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3><i class="fas fa-bell"></i> Notifications</h3>
                            <div class="setting-item">
                                <div class="setting-label">
                                    <label>Notifications par email</label>
                                    <small>Recevez les alertes par email</small>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="emailNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <div class="setting-label">
                                    <label>Alertes système</label>
                                    <small>Notifications dans l'application</small>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="systemAlerts" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <div class="setting-label">
                                    <label>Notifications de connexion</label>
                                    <small>Alertes de nouvelles connexions</small>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="loginNotifications">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3><i class="fas fa-eye"></i> Confidentialité</h3>
                            <div class="setting-item">
                                <div class="setting-label">
                                    <label>Profil visible</label>
                                    <small>Votre profil est visible aux autres utilisateurs</small>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="visibleProfile" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <div class="setting-label">
                                    <label>Historique de connexion</label>
                                    <small>Enregistrer vos connexions</small>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="loginHistory" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section danger-section">
                            <h3><i class="fas fa-exclamation-triangle"></i> Données & Compte</h3>
                            <div class="setting-item">
                                <button class="btn-secondary" onclick="downloadDataExport()"><i class="fas fa-download"></i> Télécharger mes données</button>
                            </div>
                            <div class="setting-item">
                                <button class="btn-danger" onclick="confirmDeleteAccount()"><i class="fas fa-trash"></i> Supprimer mon compte</button>
                            </div>
                        </div>

                        <div class="settings-save">
                            <button class="btn-primary" onclick="saveSettings()"><i class="fas fa-check"></i> Enregistrer les modifications</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="staff.js"></script>
    <script src="salary.js"></script>
    <script src="permissions.js"></script>
    <script src="users.js"></script>
    <script src="hierarchy.js"></script>
    <script src="drugs.js"></script>
    <script src="medicaments.js"></script>
    <script src="dispatch.js"></script>
    <script src="fiche-ems.js"></script>
    <script src="fiches-employe.js"></script>
    <script src="login.js"></script>
    <script src="app.js"></script>
</body>
</html>
